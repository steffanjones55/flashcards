<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welsh Flashcards - Mastery Edition</title>
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
  <style>
    body {
      background-color: #0f172a; 
      background-image: radial-gradient(#1e293b 1px, transparent 1px);
      background-size: 30px 30px;
      color: #f8fafc;
      font-family: 'Segoe UI', system-ui, sans-serif;
      margin: 0; padding: 20px; text-align: center;
    }
    h1 { font-family: 'Georgia', serif; font-style: italic; font-size: 3rem; color: #f472b6; text-shadow: 2px 2px 10px rgba(244, 114, 182, 0.4); }
    #home, #flashcards { max-width: 800px; margin: 0 auto; background: #1e293b; padding: 40px; border-radius: 30px; border: 2px solid #334155; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
    .unit-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); gap: 15px; margin-top: 20px; }
    .card { width: 90%; max-width: 400px; height: 250px; margin: 30px auto; background: #ffffff; color: #1e293b; display: flex; align-items: center; justify-content: center; font-size: 32px; font-weight: 600; border-radius: 20px; box-shadow: 0 10px 0px #f472b6; cursor: pointer; padding: 25px; user-select: none; }
    .card.review-mode { box-shadow: 0 10px 0px #38bdf8; border: 2px solid #38bdf8; }
    button { background-color: #334155; color: #fdf2f8; border: 1px solid #475569; border-radius: 12px; padding: 12px 18px; font-weight: 600; cursor: pointer; transition: 0.2s; }
    button:hover { background-color: #f472b6; color: white; transform: scale(1.05); }
    #cleanup-view { text-align: left; background: #0f172a; padding: 20px; border-radius: 20px; margin-top: 20px; }
    .cleanup-item { display: flex; align-items: center; gap: 10px; padding: 10px; border-bottom: 1px solid #334155; }
    .hidden { display: none !important; }
    label { cursor: pointer; display: block; width: 100%; }
  </style>
</head>
<body>

  <h1>Cymraeg Flashcards</h1>

  <div id="home">
    <button onclick="toggleDirection()" id="directionBtn" style="width:100%; max-width:350px; background:linear-gradient(135deg, #db2777, #f472b6); border:none; border-radius:50px; padding:15px; font-size:1.1rem; margin-bottom:20px;">Welsh → English</button>
    <div class="unit-grid" id="unit-buttons">
      </div>
  </div>

  <div id="flashcards" class="hidden">
    <p id="progress-text" style="color:#94a3b8; letter-spacing:2px; font-size:0.8rem;"></p>
    <h2 id="unit-title" style="color: #f472b6; font-style: italic;"></h2>
    
    <div id="card-area">
        <div class="card" id="flashcard-element" onclick="flipCard()">
          <span id="card-text"></span>
        </div>
        <div style="margin-top: 20px;">
          <button onclick="nextCard()" style="background: #db2777; color: white; padding: 15px 30px;">Next Card</button>
          <button id="save-btn" onclick="repeatWord()">Save for Later</button>
          <button id="review-now-btn" class="hidden" onclick="reviewSavedNow()" style="background-color: #0ea5e9; color: white;">Review Saved</button>
        </div>
    </div>

    <div id="cleanup-view" class="hidden">
        <h3 style="color:#38bdf8;">Review Complete!</h3>
        <p>Uncheck the words you have mastered to remove them from your review list:</p>
        <div id="cleanup-list"></div>
        <button onclick="confirmCleanup()" style="background: #10b981; color: white; width: 100%; padding: 15px; margin-top:20px;">Confirm & Continue</button>
    </div>

    <br><br>
    <button onclick="location.reload()" style="background: transparent; border: none; color: #94a3b8; text-decoration: underline;">Back to Home</button>
  </div>

<script>
    const UNITS = {
        unitA_days: [{front:"dydd Sul",back:"Sunday"},{front:"dydd Llun",back:"Monday"},{front:"dydd Mawrth",back:"Tuesday"}],
        unit1: [{front:"nos",back:"night"},{front:"noswaith",back:"evening"},{front:"paned",back:"cuppa"},{front:"bore(au)",back:"morning(s)"}],
        // Add all your other units here...
    };

    let direction = "welsh-to-english";
    let words = []; 
    let index = 0; 
    let showingFront = true;
    let trickyWords = []; 
    
    let backupWords = [];
    let backupIndex = 0;
    let isReviewingTricky = false;

    // Generate Buttons
    const grid = document.getElementById('unit-buttons');
    Object.keys(UNITS).forEach(key => {
        let btn = document.createElement('button');
        btn.innerText = key.replace('unit', 'Unit ').replace('_', ' ');
        btn.onclick = () => startUnit(key);
        grid.appendChild(btn);
    });

    function startUnit(unitKey) {
        trickyWords = [];
        words = [...UNITS[unitKey]].sort(() => Math.random() - 0.5);
        index = 0;
        isReviewingTricky = false;
        document.getElementById("unit-title").innerText = unitKey.toUpperCase().replace('_', ' ');
        document.getElementById("home").classList.add("hidden");
        document.getElementById("flashcards").classList.remove("hidden");
        showCard();
    }

    function showCard() {
        document.getElementById("card-area").classList.remove("hidden");
        document.getElementById("cleanup-view").classList.add("hidden");
        
        const card = words[index];
        const textDisplay = document.getElementById("card-text");
        const el = document.getElementById("flashcard-element");
        
        el.classList.toggle("review-mode", isReviewingTricky);
        
        if (direction === "welsh-to-english") {
            textDisplay.innerText = showingFront ? card.front : card.back;
        } else {
            textDisplay.innerText = showingFront ? card.back : card.front;
        }
        document.getElementById("progress-text").innerText = `CARD ${index + 1} OF ${words.length}`;
    }

    function flipCard() { showingFront = !showingFront; showCard(); }

    function nextCard() {
        index++;
        if (index >= words.length) {
            if (isReviewingTricky) {
                showCleanupScreen();
            } else if (trickyWords.length > 0) {
                alert("Main unit done! Let's practice those saved words...");
                reviewSavedNow();
            } else {
                finishEverything();
            }
            return;
        }
        showingFront = true;
        showCard();
    }

    function repeatWord() {
        const current = words[index];
        if (!trickyWords.find(w => w.front === current.front)) {
            trickyWords.push(current);
        }
        document.getElementById("review-now-btn").classList.remove("hidden");
        const btn = document.getElementById("save-btn");
        btn.innerText = "Saved! ✨";
        setTimeout(() => btn.innerText = "Save for Later", 800);
    }

    function reviewSavedNow() {
        if (!isReviewingTricky) {
            backupWords = [...words];
            backupIndex = index;
        }
        words = [...trickyWords].sort(() => Math.random() - 0.5);
        index = 0;
        isReviewingTricky = true;
        showingFront = true;
        document.getElementById("review-now-btn").classList.add("hidden");
        showCard();
    }

    function showCleanupScreen() {
        document.getElementById("card-area").classList.add("hidden");
        document.getElementById("cleanup-view").classList.remove("hidden");
        const list = document.getElementById("cleanup-list");
        list.innerHTML = "";
        
        trickyWords.forEach((word, i) => {
            list.innerHTML += `
                <div class="cleanup-item">
                    <input type="checkbox" checked id="check-${i}" data-idx="${i}">
                    <label for="check-${i}"><strong>${word.front}</strong> - ${word.back}</label>
                </div>
            `;
        });
    }

    function confirmCleanup() {
        const checks = document.querySelectorAll('#cleanup-list input');
        let newTricky = [];
        checks.forEach(c => {
            if (c.checked) newTricky.push(trickyWords[c.dataset.idx]);
        });
        trickyWords = newTricky;

        // If we still have words in the main unit to finish
        if (backupWords.length > 0) {
            words = [...backupWords];
            index = backupIndex;
            backupWords = [];
            isReviewingTricky = false;
            showingFront = true;
            if (trickyWords.length > 0) document.getElementById("review-now-btn").classList.remove("hidden");
            showCard();
        } else {
            // If the main unit was already done, check if we need to loop tricky words again
            if (trickyWords.length > 0) {
                alert("A few left to master! Round two...");
                reviewSavedNow();
            } else {
                finishEverything();
            }
        }
    }

    function finishEverything() {
        confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 }, colors: ['#f472b6', '#38bdf8', '#ffffff'] });
        setTimeout(() => {
            alert("Unit Complete! Da iawn!");
            location.reload();
        }, 1000);
    }

    function toggleDirection() {
        direction = (direction === "welsh-to-english") ? "english-to-welsh" : "welsh-to-english";
        document.getElementById("directionBtn").innerText = direction === "welsh-to-english" ? "Welsh → English" : "English → Welsh";
    }
</script>
</body>
</html>
